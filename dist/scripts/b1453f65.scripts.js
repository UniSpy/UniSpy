"use strict";angular.module("uniSpyApp",["ngResource"]);var app=angular.module("uniSpyApp",[]);app.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),angular.module("uniSpyApp",["ui.bootstrap"]),angular.module("uniSpyApp").controller("MainCtrl",["$scope","$http","$filter",function(a,b){function c(){a.recommendations=angular.copy(a.entries);for(var b in a.entries){var c=a.entries[b];if(void 0!==c.meals){var d=!0;for(var e in c.meals.fi){var f=c.meals.fi[e],g=!0,h=[];for(var i in f){var j=f[i];a.isTagged(j)&&(h.push(j),g=!1)}a.recommendations[b].meals.fi[e]=h,g||(d=!1)}d&&delete a.recommendations[b]}}console.log(a.recommendations)}a.days=["Maanantai","Tiistai","Keskiviikko","Torstai","Perjantai","Lauantai","Sunnuntai"],b.get("http://unispy-backend.herokuapp.com/menus.json").success(function(b){a.entries=b,void 0!==a.tags&&c()}),b.get("http://unispy-backend.herokuapp.com/tags.json").success(function(b){a.tags=new Array;for(var d in b)a.tags.push(b[d].content);console.log(a.tags),void 0!==a.entries&&c()}),a.taggedOnly=!1,a.shouldDisplay=function(b){return!a.taggedOnly||a.isTagged(b)},a.toggleTagged=function(){a.taggedOnly=!a.taggedOnly},a.hasMeals=function(a){return!!a.length},a.onlyUnicafe=function(a){return void 0===a?!1:a.name.indexOf("Unicafe")>-1},a.onlyUnicafeWithFinnnishMeals=function(b){return a.onlyUnicafe(b)&&b.meals.fi.length>0},a.isTagged=function(b){for(var c in a.tags)if(b.toLowerCase().indexOf(a.tags[c].toLowerCase())>-1)return!0;return!1}}]),angular.module("uniSpyApp").controller("SideCtrl",["$scope",function(a){a.isCollapsed=!0,a.addTag=function(){console.log("BLAAAGT!")}}]);var app=angular.module("uniSpyApp");app.factory("Auth",["$http",function(a){var b="http://unispy-backend.herokuapp.com/session",c={};return c.logged={},c.login=function(d){return console.log("Logging in :D"),a.post(b,d).then(function(b){return c.logged.status=!0,c.logged.user=d.user,a.defaults.headers.common["auth-token"]=b.data,b.data})},c.logout=function(){return a.delete(b).then(function(){return c.logged.status=!1,c.logged.user=null,delete a.defaults.headers.common["auth-token"],null})},c}]),angular.module("uniSpyApp").controller("LoginCtrl",["$scope","$modal","Auth",function(a,b,c){a.login=function(){c.login(a.credentials).then(function(){console.log("login success!"),a.$close(),console.log("login success2!")},function(){console.log("login fail!"),a.$close()}),a.credentials={}},a.open=function(){console.log("BLAA!"),b.open({templateUrl:"views/login.html",controller:"LoginCtrl",size:"sm"})}}]);